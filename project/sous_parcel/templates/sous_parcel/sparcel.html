{% extends 'panel/base.html' %}

{% block title %}{{sparcel.name}} | {% endblock %}

{% block content %}

<div id="dash-content" class="bg-gray-200 py-6 lg:py-0 w-full lg:max-w-sm flex flex-wrap content-start">

</div>
<div id="main-content" class="w-full flex-1">
    <div class="p-10 lg:p-20 text-center">
        <h1 class="text-3xl lg:text-6xl text-white">{{sparcel.name}}</h1>
    </div>
    <div class=" text-center" id="Graph">
        <h6 class="text-white" id="value">{{sparcel.name}}</h6>
        <h6 class="text-white" id="capterName">{{sparcel.name}}</h6>

    </div>
    
</div>


<div id="main-content" class="w-full flex-1">

    <div class="flex flex-1 flex-wrap">

        <div class="w-full xl:w-2/3 p-6 xl:max-w-6xl">

            <!--"Container" for the graphs"-->
            <div class="max-w-full lg:max-w-3xl xl:max-w-5xl">

                <!--Graph Card-->
                <div class="border-b p-3">
                    <h5 class="font-bold text-black">Graph</h5>
                </div>
                <div class="p-5">
                    <div class="ct-chart ct-golden-section" id="chart1"></div>
                </div>
                <!--/Graph Card-->

                <!--Table Card-->
                <div class="p-3">
                    <div class="border-b p-3">
                        <h5 class="font-bold text-black">Table</h5>
                    </div>
                    <div class="p-5">
                        <table class="w-full p-5 text-gray-700">
                            <thead>
                                <tr>
                                    <th class="text-left text-blue-900">Name</th>
                                    <th class="text-left text-blue-900">Side</th>
                                    <th class="text-left text-blue-900">Role</th>
                                </tr>
                            </thead>

                            <tbody>
                                <tr>
                                    <td>Obi Wan Kenobi</td>
                                    <td>Light</td>
                                    <td>Jedi</td>
                                </tr>
                                <tr>
                                    <td>Greedo</td>
                                    <td>South</td>
                                    <td>Scumbag</td>
                                </tr>
                                <tr>
                                    <td>Darth Vader</td>
                                    <td>Dark</td>
                                    <td>Sith</td>
                                </tr>
                            </tbody>
                        </table>

                        <p class="py-2"><a href="#">See More issues...</a></p>

                    </div>
                </div>
                <!--/table Card-->

            </div>

        </div>

        <div class="w-full xl:w-1/3 p-6 xl:max-w-4xl border-l-1 border-gray-300">

            <!--"Container" for the graphs"-->
            <div class="max-w-sm lg:max-w-3xl xl:max-w-5xl">

                <!--Graph Card-->

                <div class="border-b p-3">
                    <h5 class="font-bold text-black">Graph</h5>
                </div>
                <div class="p-5">
                    <div class="ct-chart ct-golden-section" id="chart2"></div>
                </div>

                <!--/Graph Card-->

                <!--Graph Card-->
                <div class="border-b p-3">
                    <h5 class="font-bold text-black">Graph</h5>
                </div>
                <div class="p-5">
                    <div class="ct-chart ct-golden-section" id="chart3"></div>
                </div>

                <!--/Graph Card-->

                <!--Graph Card-->

                <div class="border-b p-3">
                    <h5 class="font-bold text-black">Graph</h5>
                </div>
                <div class="p-5">
                    <div class="ct-chart ct-golden-section" id="chart4"></div>
                </div>

                <!--/Graph Card-->

                <!--Template Card-->
                <div class="p-3">
                    <div class="border-b p-3">
                        <h5 class="font-bold text-black">Template</h5>
                    </div>
                    <div class="p-5">

                    </div>
                </div>
                <!--/Template Card-->

            </div>

        </div>

    </div>

</div>

{{sparcel.id|json_script:"sparcel_id"}}
<script src="https://cdn.jsdelivr.net/chartist.js/latest/chartist.min.js"></script>
<script type ="module">


    var capters = {{capters_list|safe}};
    console.log(capters);
    for (var i = 0; i <capters.length; i++) {
        console.log(capters[i].id);
        }
   
        fetch('{% url 'sous_parcel:capter_value' sparcel.id %}')
        .then(response => response.json())
        .then(data => {
            data.valeurs.forEach(datum => {
                if (datum.capteur_id == '1') {
                    mainChart.data.series[0].push(datum.content);
                    mainChart.data.labels.push(datum.date_added.slice(17,20));
                } else if (datum.capteur_id == '2') {
                    mainChart.data.series[1].push(datum.content);
                }
                console.log(datum.date_added);
            });
            mainChart.update();
        });
   
</script>


{% endblock %}
{%block scripts %}

        <script>
            /* Refer to https://gionkunz.github.io/chartist-js/examples.html for setting up the graphs */
            var mainChart = new Chartist.Line('#chart1', {
                labels: [],
                series: [
                    [],
                    [],
                    
                ]
            }, {
                low: 0,
                showArea: true,
                showPoint: false,
                fullWidth: true
            });
        
            mainChart.on('draw', function(data) {
                if (data.type === 'line' || data.type === 'area') {
                    data.element.animate({
                        d: {
                            begin: 1000 * data.index,
                            dur: 1000,
                            from: data.path.clone().scale(1, 0).translate(0, data.chartRect.height()).stringify(),
                            to: data.path.clone().stringify(),
                            easing: Chartist.Svg.Easing.easeOutQuint
                        }
                    });
                }
            });

          
          
            var chartScatter = new Chartist.Line('#chart2', {
                labels: ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12'],
                series: [
                    [12, 9, 7, 8, 5, 4, 6, 2, 3, 3, 4, 6],
                    [4, 5, 3, 7, 3, 5, 5, 3, 4, 4, 5, 5],
                    [5, 3, 4, 5, 6, 3, 3, 4, 5, 6, 3, 4],
                    [3, 4, 5, 6, 7, 6, 4, 5, 6, 7, 6, 3]
                ]
            }, {
                low: 0
            });
    
            chartScatter.on('draw', function(data) {
                if (data.type === 'line' || data.type === 'area') {
                    data.element.animate({
                        d: {
                            begin: 500 * data.index,
                            dur: 1000,
                            from: data.path.clone().scale(1, 0).translate(0, data.chartRect.height()).stringify(),
                            to: data.path.clone().stringify(),
                            easing: Chartist.Svg.Easing.easeOutQuint
                        }
                    });
                }
            });
    
            
        </script>
            <script>
                const sparcel_id = JSON.parse(document.getElementById("sparcel_id").textContent);
                const sparcelsocket = new WebSocket(
                'ws://'
                + window.location.host
                +'/ws/'
                + sparcel_id
                +'/'
                );
                sparcelsocket.onmessage = function(e){
                    console.log(e.data);
                    const data = JSON.parse(e.data);
                    if(data.value){
                        document.getElementById("value").innerHTML= data.value;
                        document.getElementById("capterName").innerHTML= data.capterid;
                    }else{
                        console.log('there is no value');
                    }
                }


            </script>
            
{% endblock %}
